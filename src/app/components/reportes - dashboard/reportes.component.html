<div class="reportes-container">
  <header class="reportes-header">
    <div class="header-content">
      <div class="header-text">
        <h1>游늵 Reportes y An치lisis</h1>
        <p>Visualiza y analiza el rendimiento de tu inventario</p>
      </div>
    </div>
  </header>

  <!-- KPIs principales -->
  <section class="kpis-section">
    <div class="kpi-card primary">
      <div class="kpi-icon">游눯</div>
      <div class="kpi-content">
        <span class="kpi-label">Valor Total Inventario</span>
        <h2 class="kpi-value">{{ formatoMoneda(valorInventario) }}</h2>
      </div>
    </div>

    <div class="kpi-card warning">
      <div class="kpi-icon">丘멆잺</div>
      <div class="kpi-content">
        <span class="kpi-label">Productos Bajo Stock</span>
        <h2 class="kpi-value">{{ bajoStock.length }}</h2>
      </div>
    </div>
  </section>

  <!-- Secci칩n combinada: M치s Vendidos + Bajo Stock lado a lado -->
  <section class="side-by-side-section" *ngIf="masVendidos.length > 0 || bajoStock.length > 0">
    
    <!-- Productos M치s Vendidos -->
    <div class="report-card" *ngIf="masVendidos.length > 0">
      <div class="table-header">
        <h3>游끥 Productos M치s Vendidos</h3>
      </div>

      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Producto</th>
              <th>Vendidos</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of masVendidos; index as i">
              <td>{{ i + 1 }}</td>
              <td>{{ item.nombre || item.codigo_producto }}</td>
              <td><strong>{{ item.total_vendido || 0 }}</strong></td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Gr치fica Productos M치s Vendidos -->
      <div class="chart-container" *ngIf="isBrowser">
        <div class="chart-header">
          <h4>Distribuci칩n de Ventas</h4>
        </div>
        <div class="chart-wrapper">
          <canvas baseChart [data]="masVendidosChartData" type="bar" [options]="masVendidosChartOptions">
          </canvas>
        </div>
      </div>
    </div>

    <!-- Productos Bajo Stock -->
    <div class="report-card" *ngIf="bajoStock.length > 0">
      <div class="table-header">
        <h3>丘멆잺 Productos con Bajo Stock</h3>
      </div>

      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>Producto</th>
              <th>Stock</th>
              <th>Categor칤a</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let prod of bajoStock">
              <td>{{ prod.nombre }}</td>
              <td>{{ prod.stock || 0 }}</td>
              <td>{{ prod.categoria_nombre || 'Sin categor칤a' }}</td>
            </tr>
          </tbody> 
        </table>
      </div>

      <!-- Gr치fica Bajo Stock por Categor칤a -->
      <div class="chart-container" *ngIf="isBrowser">
        <div class="chart-header">
          <h4>Bajo Stock por Categor칤a</h4>
        </div>
        <div class="chart-wrapper">
          <canvas baseChart [data]="bajoStockChartData" type="pie" [options]="bajoStockChartOptions">
          </canvas>
        </div>
      </div>
    </div>
  </section>
</div>